# Albatross.CommandLine

A .NET library that simplifies creating command-line applications with [System.CommandLine](https://learn.microsoft.com/en-us/dotnet/standard/commandline/). 
It provides automatic code generation and dependency injection support while maintaining full access to System.CommandLine's capabilities.  It is opionionated toward async actions with out of box support for action cancellation and graceful shutdown.


üéâ **Now using System.CommandLine v2 stable release** for improved reliability and long-term support.

## ‚ú® Key Features

- **üöÄ Minimal Boilerplate** - Attribute-based command definition with automatic code generation
- **üîß Type Safety** - Leverages C# nullable reference\value types for automatic requirement detection
- **üì¶ Dependency Injection** - Built-in DI container integration
- **üéØ Full Flexibility** - Direct access to System.CommandLine when needed
- **üõ†Ô∏è Out of Box Support for Cancellation and Graceful Shutdown** - Built-in Support for Ctr->C Interruption via Cancellation tokens and Graceful Shutdown
- **üåü Minimum Dependencies** - Only depends on System.CommandLine and Microsoft.Extensions.Hosting.
- **üåü Easy Extensions** Use [CommandHost.ConfigureHost](CommandHost.cs) to bootstrap additional services or use [Albatross.CommandLine.Default](https://www.nuget.org/packages/Albatross.CommandLine.Default) to include Serilog logging via [Albatross.Logging](https://www.nuget.org/packages/Albatross.Logging) and Json\Environmental Configuration Support via [Albatross.Config](https://www.nuget.org/packages/Albatross.Config).

## üìñ Documentation

**üìö [Complete Documentation](https://rushuiguan.github.io/commandline/)**

### Quick Links
- **[Quick Start Guide](https://rushuiguan.github.io/commandline/articles/quick-start.html)** - Verb, Option, and Argument attributes
- **[Code Generator](https://rushuiguan.github.io/commandline/articles/code-generator.html)** - How automatic code generation works
- **[Shared Options](https://rushuiguan.github.io/commandline/articles/shared-options.html)** - Share common options across commands
- **[Manual Commands](https://rushuiguan.github.io/commandline/articles/manual-command.html)** - Direct System.CommandLine integration

## üîß Dependencies
- **System.CommandLine 2.0.1+**
- **Microsoft.Extensions.Hosting 8.0.1+**

## üîß Prerequisites
- **C# Compiler 4.10.0+** (included with .NET 8 SDK)

## üöÄ Quick Start

### 1. Install Package

```xml
<PackageReference Include="Albatross.CommandLine" Version="8.0.1" />
```

### 2. Create Program.cs

```csharp
internal class Program {
		static async Task<int> Main(string[] args) {
			await using var host = new CommandHost("Sample Command Line Application")
				.RegisterServices(RegisterServices)
				// this method is generated by source generator
				.AddCommands()
				.Parse(args)
				.Build();
			return await host.InvokeAsync();
		}
		static void RegisterServices(ParseResult result, IConfiguration configuration, IServiceCollection services) {
			// RegisterCommands method is generated by codegen
			services.RegisterCommands();
			// register your dependencies here
			services.AddSingleton<IMyService, MyService>();
		}
	}
}
```

### 3. Define Your Command

```csharp
[Verb<HelloCommandAction>("hello", Description = "Say hello to someone")]
public record class HelloOptions {
    // Required argument (position 0)
    [Argument(Description = "Name to greet")]
    public required string Name { get; init; }
    
    // Optional option
    [Option(Description = "Number of times to greet")]
    public int Count { get; init; } = 1;
}

public class HelloCommandAction : CommandAction<HelloOptions> {
    public HelloCommandAction(HelloOptions options) : base(options) {
    }

    public override async Task<int> Invoke(CancellationToken cancellationToken) {
        for (int i = 0; i < options.Count; i++) {
            await this.Writer.WriteLineAsync($"Hello, {options.Name}!");
        }
        return 0;
    }
}
```

### 5. Run It!

```bash
dotnet run -- hello "World" --count 3
```

**That's it!** The code generator automatically creates the command class and service registrations.

## üåü Advanced Features

### Sub-Commands
```csharp
[Verb<DatabaseBackupAction>("database backup")]
[Verb<DatabaseRestoreAction>("database restore")]
// Creates: database backup, database restore
```

### Shared Options
```csharp
[Verb<ProjectCommandAction>("project build", UseBaseOptionsClass = typeof(ProjectOptions))]
public record class BuildOptions : ProjectOptions {
    [Option] public string Configuration { get; init; } = "Release";
}
```

### Manual Commands
```csharp
// Full System.CommandLine control when needed
setup.CommandBuilder.AddWithParentKey("tools", new CustomCommand());
```

## üéØ Global Options

The library creates a single recursive option for logging purposes.
- `-v, --verbosity` - Logging level (Error, Warning, Information, Info, Debug, Trace)

## ü§ù Samples
See the [Sample.CommandLine](../Sample.CommandLine/) project for comprehensive examples of all features.

## üì¶ Related Packages
- [Albatross.CommandLine.Default](https://www.nuget.org/packages/Albatross.CommandLine.Default) - Default setup with logging and configuration

---

**[üìñ Read the Full Documentation ‚Üí](https://rushuiguan.github.io/commandline/)**
